<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>캐치 부실핑!</title>
<link rel="stylesheet" href="/static/dashboard.css">
<link rel="stylesheet" href="/static/scroll_up.css">


<!-- FastAPI/Jinja2가 내려준 DB 데이터 주입 -->
<script>
  window.SERVER_COMPANIES = JSON.parse('{{ companies | safe }}');
</script>
<script src="/static/dashboard.js" defer></script>
<link rel="icon" type="image/png" href="/static/images/favicon.png">
</head>

<body>
<div class="app">

  <!-- SIDEBAR -->
  <div id="sidebar" class="sidebar" style="background:white;">
    {% include 'sidebar.html' %}
  </div>

  <!-- TOPBAR -->
  <header class="topbar">
    <button class="btn collapse-btn" id="openSidebar">메뉴</button>
    <div class="search"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.3-4.3"/></svg><input id="q" placeholder="기업명 또는 기업코드 검색"/><button class="btn" id="searchBtn">검색</button></div>
    <div class="toolbar">
      <button class="btn" id="darkToggle">다크/라이트</button>
      <!-- <button class="btn" id="exportCsv">CSV</button> -->
      <!-- <div class="avatar">AI채팅</div> -->
      <button onclick="window.open('/chat', '_blank', 'width=600,height=700')">대출 상담</button>
    </div>
  </header>

  <!-- MAIN -->
  <main class="main">
    <div class="breadcrumbs" style="font-weight: bold;"><a href="/main">홈</a> · <span><a href="/firm">기업분석 대시보드</a></span></div>
    <div class="title-row">
      <div>
        <div class="h1">기업신용 리스크 대시보드</div>
        <div class="sub">PD, 신용등급, 업종 평균 및 재무/현금흐름/활동성/성장성의 통합 관제</div>
      </div>
      <div class="toolbar">
        <span class="chip" id="chipCompany">회사: 전체</span>
        <span class="chip" id="chipIndustry">업종: 전체</span>
        <span class="chip" id="chipPD">PD: 0~100%</span>
      </div>
    </div>

  

    <!-- 기업 기본정보 카드 -->
    <section class="card company-profile">
      <header class="card-header">
        <h3 class="company-title" id="selectedCompanyName" style="padding-top:20px;">기업명</h3>
        <p class="company-subtitle">
          <span id="selectedCompanyCode" class="company-code">기업코드: -</span>
        </p>
      </header>
      <div class="card-body">
        <dl class="info-grid">
          <div class="info-item">
            <dt>설립일</dt>
            <dd id="companyFounded">-</dd>
          </div>
          <div class="info-item">
            <dt>대표이사</dt>
            <dd id="companyCEO">-</dd>
          </div>
          <div class="info-item">
            <dt>기업규모</dt>
            <dd id="companySize">-</dd>
          </div>
          <div class="info-item">
            <dt>업종분류</dt>
            <dd id="companyIndustry">-</dd>
          </div>
        </dl>
        <div class="card company-profile" style="text-align: center;" >
          <button id="genReportBtn" style="margin:10px; color:deeppink">새 리포트 생성하기</button>
          <div id="reportBox" style="white-space: pre-wrap;"></div>
        </div>
      </div>
    </section>

    <!-- FILTER BAR -->
    <section class="card">
      <div class="hd">
        <div>
          <div class="title">필터</div>
          <div class="muted">산업/규모/PD/등급/검색으로 전체 카드와 차트가 동기 업데이트됩니다.</div>
        </div>
        <div class="toolbar">
          <button class="btn" id="applyFilters">적용</button>
          <button class="btn" id="resetFilters">초기화</button>
        </div>
      </div>
      <div class="bd">
        <div class="filters">
          <div class="control">
            <label>업종</label>
            <select id="fIndustry">
              <option value="all">전체</option>
              <option>제조업</option>
              <option>건설업</option>
              <option>숙박 및 음식점업</option>
              <option>도매 및 소매업</option>
              <option>전문, 과학 및 기술 서비스업</option>
              <option>운수 및 창고업</option>
              <option>정보통신업</option>
              <option>사업시설 관리, 사업 지원 및 임대 서비스업</option>
              <option>교육 서비스업</option>
              <option>전기, 가스, 증기 및 공기조절 공급업</option>
              <option>예술, 스포츠 및 여가관련 서비스업</option>
              <option>협회 및 단체, 수리 및 기타 개인 서비스업</option>
              <option>농업, 임업 및 어업</option>
            </select>
          </div>
          <div class="control">
            <label>회사 규모</label>
            <select id="fSize">
              <option value="all">전체</option>
              <option>중소기업</option>
              <option>중견기업</option>
              <option>대기업</option>
            </select>
          </div>
          <div class="control">
            <label>대출 등급</label>
            <select id="fGrade">
              <option value="all">전체 (A~D)</option>
              <option>A</option>
              <option>B</option>
              <option>C</option>
              <option>D</option>
            </select>
          </div>
          <div class="control">
            <label>PD 범위 (%)</label>
            <div class="range">
              <input type="number" id="fPDMin" value="0" min="0" max="50" style="width:80px"/>
              <span>~</span>
              <input type="number" id="fPDMax" value="100" min="0" max="50" style="width:80px"/>
            </div>
          </div>
          <!-- <div class="control">
            <label>기간</label>
            <select id="fRange">
              <option value="36m">최근 36개월</option>
              <option value="24m">최근 24개월</option>
              <option value="12m">최근 12개월</option>
            </select>
          </div> -->
          <div class="control">
            <label>연도</label>
            <select id="fYear">
              <option value="all">전체</option>
              <option value="2023">2023</option>
              <option value="2022">2022</option>
              <option value="2021">2021</option>
            </select>
          </div>
          <!-- <div class="control">
            <label>검색</label>
            <input type="text" id="fQuery" placeholder="기업명 또는 기업코드"/>
          </div> -->
        </div>
      </div>
    </section>

    

    <!-- <section>
      <div class="card company-profile" style="text-align: center;">
        <button id="genReportBtn" style >새 리포트 생성하기</button>
        <div id="reportBox" style="white-space: pre-wrap; margin-top:20px;"></div>
      </div>
    </section> -->

    <!-- KPIs -->
    <section class="grid kpis">
      <!-- 기업 Credit Score -->
      <div class="card fade-in">
        <div class="hd">
          <div class="title">대출등급 (개별)</div>
          <div class="muted">등급 (A~D)</div>
        </div>
        <!-- 2등분 레이아웃 -->
        <div class="bd kpi" style="display:grid; grid-template-columns: 1fr 1fr; align-items:center; padding:1.5rem;">
          <!-- 왼쪽: 큰 등급 -->
          <div id="kpiGrade" style="font-size:3.5rem; font-weight:700; text-align:center;">A</div>
          <!-- 오른쪽: 설명 -->
          <div style="display:flex; flex-direction:column; align-items:flex-start; gap:0.25rem;">
            <div class="delta good" id="kpiGradeDelta">등급 안정</div>
            <div class="muted">점수 <b id="kpiScore">780</b> / 900</div>
          </div>
        </div>
      </div>
      
      <!-- 기업 Credit Score -->
      <!-- <div class="card fade-in">
        <div class="hd"><div class="title">신용점수 (기업)</div><div class="muted">등급화 (A~D)</div></div>
        <div class="bd kpi">
          <canvas id="scoreDonut" width="120" height="120" aria-label="신용등급 도넛"></canvas>
          <div>
            <div class="num" id="kpiGrade">A</div>
            <div class="delta good" id="kpiGradeDelta">등급 안정</div>
            <div class="muted">점수 <b id="kpiScore">780</b> / 900</div>
          </div>
        </div>
      </div> -->


      <!-- 신용점수 비교 (기업 vs 업종 & 규모) -->
      <div class="card fade-in">
        <div class="hd">
          <div class="title">대출점수 (평균)</div>
          <div class="muted">vs 업종 & 규모 (pt)</div>
        </div>
        <div class="bd">
          <canvas id="chartCreditCompare" height="110"></canvas>
        </div>
      </div>



      <!-- 산업 평균 Credit Score -->
      <!-- <div class="card fade-in">
        <div class="hd"><div class="title">신용점수 (업종 평균)</div></div>
        <div class="bd kpi">
          <canvas id="scoreDonutIndustry" width="120" height="120"></canvas>
          <div>
            <div class="num" id="kpiGradeIndustry"></div>
            <div class="delta" id="kpiGradeDeltaIndustry"></div>
            <div class="muted">점수 <b id="kpiScoreIndustry"></b> / 900</div>
          </div>
        </div>
      </div> -->
      
      

      <div class="card fade-in">
        <div class="hd">
          <div class="title">부실확률 (PD)</div>
          <div class="muted">기업 PD (%)</div>
        </div>

        <!-- 2등분 레이아웃 -->
        <div class="bd kpi" style="display:grid; grid-template-columns: 1fr 1fr; align-items:center; padding:1.5rem;">
          <!-- 왼쪽: 큰 숫자 -->
          <div id="kpiPD" style="font-size:2.5rem; font-weight:700; text-align:center;">0.0%</div>

          <!-- 오른쪽: 두 줄 -->
          <div style="display:flex; flex-direction:column; align-items:flex-start; gap:0.25rem;">
            <div class="delta neutral" id="kpiPDDelta">모델 업데이트 반영</div>
            <div class="muted" id="kpiPDNote">상위 10% 위험군 아님</div>
          </div>
        </div>
      </div>



      

      <!-- <div class="card fade-in">
        <div class="hd"><div class="title">부실 확률 (기업)</div><div class="muted">PD (기업)</div></div>
        <div class="bd kpi">
          <canvas id="gaugePD" width="130" height="100" aria-label="PD 게이지"></canvas>
          <div>
            <div class="num" id="kpiPD">0.0%</div>
            <div class="delta neutral" id="kpiPDDelta">모델 업데이트 반영</div>
            <div class="muted" id="kpiPDNote">상위 10% 위험군 아님</div>
          </div>
        </div>
      </div> -->

      <div class="card fade-in">
        <div class="hd"><div class="title">부실확률 (평균)</div><div class="muted">vs 업종 & 규모 (%)</div>
      </div>
        <div class="bd">
          <canvas id="chartPDCompare" height="110"></canvas>
        </div>
      </div>

      <!-- <div class="card fade-in">
        <div class="hd"><div class="title">부실 확률 (업종 평균)</div><div class="muted">PD (업종)</div></div>
        <div class="bd kpi">
          <canvas class="spark" id="sparkIndustry"></canvas>
          <div>
            <div class="num" id="kpiIndustry">0.0%</div>
            <div class="delta" id="kpiIndustryDelta">업종 내 위치: -</div>
            <div class="muted">필터 반영</div>
          </div>
        </div>
      </div> -->
    </section>



    <!-- ANALYSIS & IMPROVEMENT -->
    <section class="grid cards2">
      <div class="card">
        <div class="hd">
          <div class="title">부실영향 상위요인 (XAI)</div>
          <div class="legend" style="display:flex; gap:12px; align-items:center; font-size:13px;">
            <!-- 기업 값 범례 (양수=파스텔, 음수=빨강) -->
            <div style="display:flex; align-items:center; gap:4px;">
              <span style="display:inline-block; width:14px; height:14px; background:linear-gradient(90deg,#93c5fd,#f9a8d4); border-radius:2px; border:1px solid #ccc;"></span>
              <span>해당 기업</span>
            </div>
            <!-- 업종 평균 범례 -->
            <div style="display:flex; align-items:center; gap:4px;">
              <span style="display:inline-block; width:14px; height:14px; background-color:#9ca3af; border-radius:2px;"></span>
              <span>업종 평균</span>
            </div>
          </div>
        </div>
        <div class="bd drivers-row">
          <canvas id="chartDrivers" height="100"></canvas>
        </div>
      </div>

      

<div class="card">
  <div class="hd">
    <div class="title">PD변화 요인 예상 시뮬레이션</div>
    <div class="muted">변수 개선 시 PD 영향</div>
      </div>
      <div class="bd">
        <div class="grid" style="grid-template-columns:1fr 1fr; gap:12px">

          <div>
            <label>ROE</label>
            <input type="range" id="sROE" min="-10" max="30" value="5" step="0.5"/>
            <div class="muted"><span id="sROEV">5</span>%</div>
          </div>

          <div>
            <label>OPTL</label>
            <input type="range" id="sOPTL" value="2" step="0.5"/>
            <div class="muted"><span id="sOPTLV">2</span>%</div>
          </div>

          <div>
            <label>FFOEQ</label>
            <input type="range" id="sFFOEQ" value="5" step="1"/>
            <div class="muted"><span id="sFFOEQV">5</span>%</div>
          </div>

          <div>
            <label>영업손익증가율</label>
            <input type="range" id="sProfitGrowth" value="10" step="1"/>
            <div class="muted"><span id="sProfitGrowthV">10</span>%</div>
          </div>

          <div>
            <label>매입채무회전율</label>
            <input type="range" id="sAPTurn" value="5" step="0.5"/>
            <div class="muted"><span id="sAPTurnV">5</span>회</div>
          </div>

          <div>
            <label>재무보상비율</label>
            <input type="range" id="sICR" value="3" step="0.5"/>
            <div class="muted"><span id="sICRV">3</span>회</div>
          </div>

        </div>
        <div class="divider"></div>
        <div style="display:flex; gap:16px; align-items:center; flex-wrap:wrap">
          <span class="status">현재 PD: <b id="simNow">-</b></span>
          <span class="status ok">개선 후 PD: <b id="simAfter">-</b></span>
          <span class="status" id="improveChance">현재 PD와의 차이: -</span>
        </div>
      </div>
    </div>
    </section>

    <!-- CHART + SUMMARY CARDS (Solvency / Profitability & Growth) -->
    <section class="grid cards3">
      <div class="card">
        <div class="hd"><div class="title">동종업계 비교</div>
          <div class="toolbar">
            <input class="btn" id="peerQuery" placeholder="기업 검색" style="min-width:200px;"/>
            <button class="btn" id="peerSearch">검색</button>
          </div>
      </div>
        <div class="bd">
          <canvas id="chartPeers" height="170"></canvas>
          <div class="divider"></div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <div>
            <div class="title">수익성·성장성</div>
            <div class="muted" style="font-size: 13px; color:black; font-weight: bold;">(개별기업)</div>
          </div>
          <div class="toolbar">
            <button class="btn" data-range="12m">1y</button>
            <button class="btn" data-range="24m">2y</button>
            <button class="btn" data-range="36m">3y</button>
          </div>
        </div>
        <div class="bd"><canvas id="chartProfitGrowth" height="200"></canvas></div>
        <div class="divider"></div>
        <div class="bd" id="profitSummary" style="text-align: center;">-</div>
      </div>
      <div class="card">
        <div class="hd">
          <div>
            <div class="title">수익성·성장성</div>
            <div class="muted" style="font-size: 13px; color:black; font-weight: bold;">(업종평균)</div>
          </div>
          <div class="toolbar">
            <button class="btn" data-range="12m">1y</button>
            <button class="btn" data-range="24m">2y</button>
            <button class="btn" data-range="36m">3y</button>
          </div>
        </div>
        <div class="bd"><canvas id="chartProfitGrowthIndustry" height="200"></canvas></div>
        <div class="divider"></div>
        <div class="bd" id="profitSummaryIndustry" style="text-align: center;">-</div>
      </div>
    </section>

    <!-- CHART + SUMMARY CARDS (Solvency / Profitability & Growth) -->
    <!-- <section class="grid cards">
      <div class="card">
        <div class="hd">
          <div>
            <div class="title">안정성 지표 (Solvency)</div>
            <div class="muted">부채비율·유동비율·당좌비율 — 게이지</div>
          </div>
          <div class="toolbar">
            <span class="chip">안정 ↔ 위험</span>
          </div>
        </div>
        <div class="bd">
          <div class="grid quads">
            <canvas id="gDebt" height="100"></canvas>
            <canvas id="gCurrent" height="100"></canvas>
            <canvas id="gQuick" height="100"></canvas>
            <div>
              <div class="muted" style="margin-bottom:8px">요약</div>
              <div id="solvencySummary">-</div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <div>
            <div class="title">수익성·성장성</div>
            <div class="muted">ROE/ROA/ROIC & 매출/영업이익 성장률</div>
          </div>
          <div class="toolbar">
            <button class="btn" data-range="12m">12M</button>
            <button class="btn" data-range="24m">24M</button>
            <button class="btn" data-range="36m">36M</button>
          </div>
        </div>
        <div class="bd"><canvas id="chartProfitGrowth" height="220"></canvas></div>
        <div class="divider"></div>
        <div class="bd" id="profitSummary">-</div>
      </div>
    </section> -->

    <!-- ACTIVITY & CASH FLOW -->
    <section class="grid panels">
      <div class="card">
        <div class="hd">
          <div>
            <div class="title">안정성 지표</div>
            
          </div>
          <div class="toolbar">
            <div class="muted">부채비율·유동비율·당좌비율 (%)</div>
          </div>
        </div>
        <div class="bd">
          <div class="grid card2">
            <canvas id="chartSolvency" height="200"></canvas>
          </div>
          <div id="chartSolvencyLegend" class="legend muted">
        <span class="swatch" style="background:#10b981"></span> 해당 기업
        <span class="swatch" style="background:#9ca3af; margin-left:16px;"></span> 업종 평균
      </div>
        </div>
      </div>
      <div class="card">
        <div class="hd">
          <div class="title">활동성 지표 </div>
          <div class="muted">회전율 (회)</div>
        </div>
        <div class="bd">
          <canvas id="chartRadar" height="200"></canvas>
          <!-- 범례 추가 -->
          <div style="display:flex;justify-content:center;align-items:center;margin-bottom:8px;font-size:0.875rem;">
            <span style="display:flex;align-items:center;margin-right:40px;">
              <span style="display:inline-block;width:12px;height:12px;background-color:rgba(37,99,235,.6);border-radius:2px;margin-right:4px;"></span>
              해당 기업
            </span>
            <span style="display:flex;align-items:center;">
              <span style="display:inline-block;width:12px;height:12px;background-color:rgba(234,88,12,.6);border-radius:2px;margin-right:4px;"></span>
              업계 평균
            </span>
          </div>
        </div>
      </div>


      <!-- <div class="card">
        <div class="hd"><div class="title">현금흐름 지표</div><div class="muted">영업CF/총자산·부채·매출 — 히트맵</div></div>
        <div class="bd"><canvas id="chartHeat" height="240"></canvas></div>
      </div> -->
      <div class="card">
        <div class="hd">
          <div class="title">영업활동 현금흐름 (3년추이)</div><div class="muted">재무건전성·효율성</div>
        </div>
        <div class="bd">
          <canvas id="chartCashflow" height="190"></canvas>
          <div id="chartCashflowLegend" class="muted" style="margin-top:8px;font-size:12px;text-align:center"></div>
        </div>
          <!-- 범례 -->
          <div id="chartCashflowLegend" class="muted" 
              style="margin-top:8px;font-size:12px;text-align:center"></div>
      </div>
    </section>

    
    <!-- EXECUTION / COMPARISON-->
    <!-- <section class="grid panels">
      <div class="card">
        <div class="hd"><div class="title">Action Plan Roadmap</div><div class="muted">Planned · In-progress · Completed</div></div>
        <div class="bd">
          <canvas id="chartRoadmap" height="200"></canvas>
          <div class="divider"></div>
          <div class="muted" id="roadmapSummary">-</div>
        </div>
      </div>
    </section> -->


    <!-- MACRO ECONOMY -->
    <!-- <section class="card">
      <div class="hd">
        <div>
          <div class="title">거시경제 정보</div>
          <div class="muted">최근 3년 추세 — GDP 성장률 · 인플레이션 · 실업률 · 금리</div>
        </div>
        <div class="toolbar">
          <button class="btn" data-m="12">12M</button>
          <button class="btn" data-m="24">24M</button>
          <button class="btn" data-m="36">36M</button>
        </div>
      </div>
      <div class="bd">
        <div class="grid quads2">
          <canvas id="mGDP" height="160"></canvas>
          <canvas id="mCPI" height="160"></canvas>
          <canvas id="mUNEMP" height="160"></canvas>
          <canvas id="mRATE" height="160"></canvas>
        </div>
      </div>
    </section> -->

    

    <!-- ENTITY TABLE -->
    <section class="card">
      <div class="hd">
        <div>
          <div class="title">기업 리스트</div>
          <div class="muted">필터 반영 · 최대 1500개</div>
        </div>
        <div class="toolbar">
          <button id="sortPD" class="btn">PD 정렬</button>
          <button id="sortScore" class="btn">점수 정렬</button>
          <button id="sortDebt" class="btn">부채비율 정렬</button>
        </div>
      </div>
      <div class="bd" style="overflow:auto; max-height:480px">
        <table class="table" id="tblEntities" style="text-align: left;">
          <thead><tr>
            <th>#</th>
            <th>기업</th>
            <th>업종</th>
            <th>규모</th>
            <th>PD(%)</th>
            <th>등급</th>
            <th>점수</th>
            <th>부채비율</th>
            <th>ROE</th>
            <th>자산(천원)</th>
          </tr></thead>
          <tbody id="entBody"></tbody>
        </table>
      </div>
    </section>

    <div class="footer">© <span id="year"></span> Catch Boosil Ping</div>
  </main>
</div>

<!-- 스크롤업 버튼 -->
<button id="toTopBtn" class="to-top" aria-label="페이지 상단으로 이동" title="맨 위로">
  <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M12 4l-7 7h4v9h6v-9h4z"></path>
  </svg>
</button>
<script src="/static/scroll_up.js"></script>


</body>

</html>

